# Автоматизация печати штрихкодов Ozon FBO

Автоматизированная система для печати штрихкодов товаров при поставках FBO на Ozon. Система автоматически определяет количество товаров в заказе и генерирует PDF с нужным количеством копий этикеток для термопринтера.

## Возможности

- Автоматическое получение данных о заказе через Ozon API (трехэтапный процесс)
- Обработка ZIP архивов со штрихкодами
- Генерация PDF с нужным количеством копий каждого штрихкода
- Удобный графический интерфейс (GUI)
- Консольный режим работы
- Автоматическая отправка на печать
- Подробное логирование всех операций
- Кросс-платформенность (Windows, macOS, Linux)

## Требования

- Python 3.8 или выше
- Ozon API credentials (Client-Id и API-Key)

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/yourusername/BarcodePrintAuto.git
cd BarcodePrintAuto
```

### 2. Создание виртуального окружения

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка конфигурации

Скопируйте `.env.example` в `.env` и заполните данные:

```bash
cp .env.example .env
```

Отредактируйте `.env`:

```env
OZON_CLIENT_ID=ваш_client_id
OZON_API_KEY=ваш_api_key
DEFAULT_PRINTER=имя_принтера  # опционально
OUTPUT_DIR=./output
LOGS_DIR=./logs
```

### Получение API credentials

1. Войдите в личный кабинет Ozon Seller
2. Перейдите в **Настройки** → **API ключи**
3. Создайте новый API ключ с правами на чтение заявок на поставку
4. Скопируйте Client-Id и API-Key в файл `.env`

## Использование

### GUI режим (рекомендуется)

Запустите графический интерфейс:

```bash
python gui.py
```

В открывшемся окне:
1. Введите номер заказа (например, `2000038642317`)
2. Выберите ZIP архив со штрихкодами
3. При необходимости включите автоматическую печать
4. Нажмите "Обработать заказ"

### Консольный режим

#### Интерактивный режим

```bash
python main.py
```

Программа запросит:
- Номер заказа (например, `2000038642317`)
- Путь к ZIP архиву
- Нужна ли автоматическая печать
- Имя принтера (если нужна печать)

#### Режим с параметрами

Базовое использование:
```bash
python main.py --order-number 2000038642317 --zip-path barcode.zip
```

С автоматической печатью:
```bash
python main.py --order-number 2000038642317 --zip-path barcode.zip --print
```

Указать конкретный принтер:
```bash
python main.py --order-number 2000038642317 --zip-path barcode.zip --print --printer "HP LaserJet"
```

Проверка конфигурации и API:
```bash
python main.py --validate
```

## Структура проекта

```
BarcodePrintAuto/
├── config.py              # Конфигурация и настройки
├── ozon_api.py           # Работа с Ozon API
├── pdf_processor.py      # Обработка PDF файлов
├── main.py               # Консольный интерфейс
├── gui.py                # Графический интерфейс
├── requirements.txt      # Зависимости Python
├── .env.example          # Шаблон конфигурации
├── .gitignore           # Игнорируемые файлы
├── README.md            # Документация
├── output/              # Выходные PDF файлы
└── logs/                # Файлы логов
```

## Модули

### config.py
Управление конфигурацией приложения:
- Загрузка переменных окружения
- Валидация настроек
- Настройка логирования

### ozon_api.py
Взаимодействие с Ozon Seller API (трехэтапный процесс):
1. **Поиск заявок** (`/v3/supply-order/list`) - поиск по номеру заказа
2. **Получение деталей** (`/v3/supply-order/get`) - получение bundle_ids и warehouse_ids
3. **Получение состава** (`/v1/supply-order/bundle`) - список товаров с количеством

Также включает:
- Статистику заказа
- Валидацию credentials

### pdf_processor.py
Обработка PDF файлов:
- Распаковка ZIP архивов
- Поиск PDF по SKU
- Объединение PDF с учетом количества
- Отправка на печать (Windows/macOS/Linux)

### main.py
Консольный интерфейс:
- Интерактивный режим
- Режим с параметрами командной строки
- Вывод статистики и результатов

### gui.py
Графический интерфейс (tkinter):
- Удобная форма ввода данных
- Визуальный лог выполнения
- Проверка API credentials
- Асинхронная обработка

## Примеры использования

### Пример 1: Обработка одного заказа

```bash
python main.py --order-number 2000038642317 --zip-path ~/Downloads/barcode_2000038642317.zip
```

Результат:
- Создан файл: `output/Заказ_2000038642317_полная.pdf`
- Лог сохранен в: `logs/ozon_automation_2025-12-26.log`

### Пример 2: Автоматическая печать

```bash
python main.py --order-number 2000038642317 --zip-path barcode.zip --print
```

### Пример 3: GUI режим

```bash
python gui.py
```

Откроется окно с формой для ввода данных и визуальным логом выполнения.

## Логирование

Все операции логируются в файлы в директории `logs/`:
- Формат: `ozon_automation_YYYY-MM-DD.log`
- Уровни: INFO, WARNING, ERROR
- Консоль и файл синхронизированы

Пример лога:
```
[2025-12-26 15:30:00] INFO: Начало обработки заказа 2000038642317
[2025-12-26 15:30:01] INFO: Поиск заявок на поставку по номеру 2000038642317
[2025-12-26 15:30:02] INFO: Найдено 1 заявок на поставку: [81182787]
[2025-12-26 15:30:03] INFO: Получение информации о заявках: [81182787]
[2025-12-26 15:30:04] INFO: Получена информация о 1 заявках
[2025-12-26 15:30:05] INFO: Получено 24 уникальных товаров
[2025-12-26 15:30:06] INFO: Всего товаров к печати: 125
[2025-12-26 15:30:10] INFO: Создан файл: Заказ_2000038642317_полная.pdf
```

## API Workflow

Приложение использует трехэтапный процесс получения данных из Ozon API:

### Этап 1: Поиск заявок на поставку
- **Endpoint:** `/v3/supply-order/list`
- **Вход:** Номер заказа (например, "2000038642317")
- **Выход:** Список `order_ids`

### Этап 2: Получение детальной информации
- **Endpoint:** `/v3/supply-order/get`
- **Вход:** `order_ids` из этапа 1
- **Выход:** `bundle_ids`, `dropoff_warehouse_id`, `storage_warehouse_ids`

### Этап 3: Получение состава поставки
- **Endpoint:** `/v1/supply-order/bundle`
- **Вход:** Данные из этапа 2
- **Выход:** Список товаров с SKU, названием, количеством и другой информацией

Этот процесс полностью автоматизирован и требует от пользователя только номер заказа.

## Обработка ошибок

### Ошибки API

```
Ошибка API: HTTP ошибка: 401 - Unauthorized
```
**Решение:** Проверьте Client-Id и API-Key в `.env` файле

### Ошибки ZIP архива

```
Ошибка обработки PDF: ZIP файл не найден
```
**Решение:** Укажите правильный путь к ZIP файлу

### Отсутствующие PDF

```
WARNING: Не найден PDF для SKU 1985236037
```
**Решение:** Проверьте содержимое ZIP архива. Программа продолжит работу с доступными файлами.

### Заказ не найден

```
Ошибка API: Не найдено ни одной заявки на поставку с номером 2000038642317
```
**Решение:** Проверьте правильность номера заказа или убедитесь, что заявка находится в статусе READY_TO_SUPPLY

## Безопасность

- API ключи хранятся в `.env` файле (не коммитится в git)
- Логи не содержат чувствительные данные
- Временные файлы автоматически удаляются после обработки

## Устранение неполадок

### Проблема: ModuleNotFoundError

**Решение:**
```bash
pip install -r requirements.txt
```

### Проблема: Не работает печать на Windows

**Решение:**
```bash
pip install pywin32
```

### Проблема: Ошибка при работе с API

**Решение:**
```bash
python main.py --validate
```

Проверит корректность API credentials.

### Проблема: Не создается PDF

**Решение:**
1. Проверьте, что ZIP архив содержит PDF файлы
2. Убедитесь, что имена файлов соответствуют SKU
3. Проверьте права на запись в директорию `output/`

## Особенности работы

### Соответствие PDF и товаров

Программа ищет PDF файлы по следующим шаблонам:
- `{SKU}.pdf` (например, `1985236037.pdf`)
- `OZN{SKU}.pdf` (например, `OZN1985236037.pdf`)
- Любой файл содержащий SKU в имени

### Порядок этикеток в итоговом PDF

Этикетки располагаются последовательно:
1. Все копии товара 1
2. Все копии товара 2
3. И т.д.

Это упрощает физическую сортировку при упаковке.

### Обработка отсутствующих PDF

Если PDF для товара не найден:
- Товар пропускается с предупреждением
- Обработка продолжается для остальных товаров
- В итоговом отчете указываются пропущенные товары

## Лицензия

MIT License

## Поддержка

При возникновении проблем:
1. Проверьте логи в директории `logs/`
2. Запустите `python main.py --validate`
3. Убедитесь, что все зависимости установлены

## Разработка

### Установка для разработки

```bash
git clone https://github.com/yourusername/BarcodePrintAuto.git
cd BarcodePrintAuto
python -m venv venv
source venv/bin/activate  # или venv\Scripts\activate на Windows
pip install -r requirements.txt
```

### Запуск тестов

```bash
# TODO: Добавить тесты
pytest
```

## Changelog

### v2.0.0 (2025-12-26)
- **BREAKING CHANGE:** Изменен вход с `supply_id` на `order_number`
- Реализован правильный трехэтапный API workflow
- Обновлена документация с правильным процессом работы с API
- Изменен формат выходных файлов: `Заказ_{order_number}_полная.pdf`

### v1.0.0 (2025-12-25)
- Первая версия
- Поддержка Ozon API
- GUI и консольный интерфейс
- Обработка ZIP архивов
- Автоматическая печать
- Кросс-платформенность

## Roadmap

- [ ] Пакетная обработка нескольких заказов
- [ ] Экспорт статистики в Excel
- [ ] Поддержка других маркетплейсов
- [ ] Веб-интерфейс
- [ ] Docker образ

## Авторы

Создано для автоматизации процесса печати штрихкодов Ozon FBO.

## Благодарности

- Ozon Seller API
- Python сообщество
- PyPDF2 разработчики
